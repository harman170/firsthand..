<!DOCTYPE html>
<html lang="en" ng-app="adminApp">

<head>
    <meta charset="UTF-8">
    <title>User Controller</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
</head>

<body ng-controller="userController" ng-init="fetchAllUsers()">

    <div class="container mt-4">
        <h3 class="text-center mb-4">User Controller</h3>

        <table class="table table-bordered text-center">
            <thead class="table-light">
                <tr>
                    <th>Email ID</th>
                    <th>User Type</th>
                    <th>Status</th>
                    <th>Operations</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="user in userArray">
                    <td>{{ user.email }}</td>
                    <td>{{ user.userType }}</td>
                    <td>{{ user.status }}</td>
                    <td>
                        <button class="btn btn-danger btn-sm me-2" ng-click="updateStatus(user.email, 0)">Block</button>
                        <button class="btn btn-success btn-sm" ng-click="updateStatus(user.email, 1)">Resume</button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <script>
        var app = angular.module("adminApp", []);
        app.controller("userController", function($scope, $http) {
            $scope.userArray = [];

            $scope.fetchAllUsers = function() {
                $http.get("/fetch-all-users").then(function(response) {
                    $scope.userArray = response.data;
                }, function(error) {
                    alert("Error fetching users: " + error.data);
                });
            };

            $scope.updateStatus = function(email, newStatus) {
                let url = "/update-status?email=" + email + "&status=" + newStatus;
                $http.get(url).then(function(response) {
                    alert(response.data);
                    $scope.fetchAllUsers();
                }, function(error) {
                    alert("Update failed: " + error.data);
                });
            };
        });
    </script>

</body>

</html>