<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/angular/angular.min.js"></script>
</head>

<body ng-app="jobApp" ng-controller="jobController" ng-init="fetchAllJobs(); dofetchallid();">
    <div class="container mt-4">
        <h3 class="text-center">Job Manager</h3>
        <h5>Instructions: Select your Job ID to view all jobs posted by you. To delete a job, simply click the Delete button next to it.</h5>
        <div class="card p-3 border border-secondary">
            <div class="mb-3">
                <label class="form-label">Select Job ID</label>
                <select class="form-select" ng-change="doFilter();" ng-model="sjobid">
                    <option value=" ">None</option>
                   <option ng-repeat="obj in jsonAryId" value="{{obj.jobid}} ">{{obj.jobid}}</option>
                    <option value="All ">All</option>
                </select>
            </div>

            <button class="btn btn-primary " ng-click="doFilter() ">Get All Published Jobs</button>
        </div>

        <div class="card mt-3 p-3 border border-secondary ">
            <h5>Show All Jobs</h5>
            <table class="table table-bordered mt-2 ">
                <thead>
                    <tr>
                        <th>Job ID</th>
                        <th>Job Title</th>
                        <th>Job Type</th>
                        <th>Firm Address</th>
                        <th>City</th>
                        <th>Education</th>
                        <th>Person Contact</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="job in jsonAry ">
                        <td>{{ job.jobid }}</td>
                        <td>{{ job.jobtitle }}</td>
                        <td>{{ job.jobtype }}</td>
                        <td>{{ job.address }}</td>
                        <td>{{ job.city }}</td>
                        <td>{{ job.edu }}</td>
                        <td>{{ job.contact }}</td>
                        <td>
                            <button class="btn btn-danger " ng-click="doDelete(job.jobid); ">Delete</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        var app = angular.module('jobApp', []);
        app.controller('jobController', function($scope, $http) {
            $scope.jsonAry = [];
            $scope.sjobid = " ";
            $scope.jsonAryId = [];

            $scope.fetchAllJobs = function() {
                let url = "/all-related-jobs ";
                $http.get(url).then(function(response) {
                    $scope.jsonAry = response.data;
                }, function(err) {
                    alert(err.data);
                });
            };

            $scope.doFilter = function() {
                let url = "/do-fetch-3?jobid=" + $scope.sjobid;

                $http.get(url).then(function(response) {
                    $scope.jsonAry = response.data;
                }, function(err) {
                    alert(JSON.stringify(err.data));
                });
            };

            $scope.dofetchallid = function() {
                let url = "/all-records-client-jobid";
                $http.get(url).then(function(response) {
                    $scope.jsonAryId = response.data;
                }, function(err) {
                    alert(err.data);
                });
            };

            $scope.doDelete = function(jobid) {
                if (confirm("R U Sure?") == false) return;
                let url = "/do-delete-one?jobid=" + jobid;
                $http.get(url).then(fxSuccess, fxFail);

                function fxSuccess(response) {
                    alert(response.data);
                    $scope.fetchAllJobs();

                }

                function fxFail(err) {
                    alert(err.data);
                }
            }
        });
    </script>
</body>

</html>